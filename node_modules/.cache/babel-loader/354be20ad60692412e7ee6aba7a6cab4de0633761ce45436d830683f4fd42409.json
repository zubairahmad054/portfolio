{"ast":null,"code":"import { MotionGlobalConfig } from 'motion-utils';\nimport { stepsOrder } from './order.mjs';\nimport { createRenderStep } from './render-step.mjs';\nconst maxElapsed = 40;\nfunction createRenderBatcher(scheduleNextBatch, allowKeepAlive) {\n  let runNextFrame = false;\n  let useDefaultElapsed = true;\n  const state = {\n    delta: 0.0,\n    timestamp: 0.0,\n    isProcessing: false\n  };\n  const flagRunNextFrame = () => runNextFrame = true;\n  const steps = stepsOrder.reduce((acc, key) => {\n    acc[key] = createRenderStep(flagRunNextFrame, allowKeepAlive ? key : undefined);\n    return acc;\n  }, {});\n  const {\n    read,\n    resolveKeyframes,\n    update,\n    preRender,\n    render,\n    postRender\n  } = steps;\n  const processBatch = () => {\n    const timestamp = MotionGlobalConfig.useManualTiming ? state.timestamp : performance.now();\n    runNextFrame = false;\n    if (!MotionGlobalConfig.useManualTiming) {\n      state.delta = useDefaultElapsed ? 1000 / 60 : Math.max(Math.min(timestamp - state.timestamp, maxElapsed), 1);\n    }\n    state.timestamp = timestamp;\n    state.isProcessing = true;\n    // Unrolled render loop for better per-frame performance\n    read.process(state);\n    resolveKeyframes.process(state);\n    update.process(state);\n    preRender.process(state);\n    render.process(state);\n    postRender.process(state);\n    state.isProcessing = false;\n    if (runNextFrame && allowKeepAlive) {\n      useDefaultElapsed = false;\n      scheduleNextBatch(processBatch);\n    }\n  };\n  const wake = () => {\n    runNextFrame = true;\n    useDefaultElapsed = true;\n    if (!state.isProcessing) {\n      scheduleNextBatch(processBatch);\n    }\n  };\n  const schedule = stepsOrder.reduce((acc, key) => {\n    const step = steps[key];\n    acc[key] = function (process) {\n      let keepAlive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      let immediate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      if (!runNextFrame) wake();\n      return step.schedule(process, keepAlive, immediate);\n    };\n    return acc;\n  }, {});\n  const cancel = process => {\n    for (let i = 0; i < stepsOrder.length; i++) {\n      steps[stepsOrder[i]].cancel(process);\n    }\n  };\n  return {\n    schedule,\n    cancel,\n    state,\n    steps\n  };\n}\nexport { createRenderBatcher };","map":{"version":3,"names":["MotionGlobalConfig","stepsOrder","createRenderStep","maxElapsed","createRenderBatcher","scheduleNextBatch","allowKeepAlive","runNextFrame","useDefaultElapsed","state","delta","timestamp","isProcessing","flagRunNextFrame","steps","reduce","acc","key","undefined","read","resolveKeyframes","update","preRender","render","postRender","processBatch","useManualTiming","performance","now","Math","max","min","process","wake","schedule","step","keepAlive","arguments","length","immediate","cancel","i"],"sources":["D:/portfolio-master/node_modules/motion-dom/dist/es/frameloop/batcher.mjs"],"sourcesContent":["import { MotionGlobalConfig } from 'motion-utils';\r\nimport { stepsOrder } from './order.mjs';\r\nimport { createRenderStep } from './render-step.mjs';\r\n\r\nconst maxElapsed = 40;\r\nfunction createRenderBatcher(scheduleNextBatch, allowKeepAlive) {\r\n    let runNextFrame = false;\r\n    let useDefaultElapsed = true;\r\n    const state = {\r\n        delta: 0.0,\r\n        timestamp: 0.0,\r\n        isProcessing: false,\r\n    };\r\n    const flagRunNextFrame = () => (runNextFrame = true);\r\n    const steps = stepsOrder.reduce((acc, key) => {\r\n        acc[key] = createRenderStep(flagRunNextFrame, allowKeepAlive ? key : undefined);\r\n        return acc;\r\n    }, {});\r\n    const { read, resolveKeyframes, update, preRender, render, postRender } = steps;\r\n    const processBatch = () => {\r\n        const timestamp = MotionGlobalConfig.useManualTiming\r\n            ? state.timestamp\r\n            : performance.now();\r\n        runNextFrame = false;\r\n        if (!MotionGlobalConfig.useManualTiming) {\r\n            state.delta = useDefaultElapsed\r\n                ? 1000 / 60\r\n                : Math.max(Math.min(timestamp - state.timestamp, maxElapsed), 1);\r\n        }\r\n        state.timestamp = timestamp;\r\n        state.isProcessing = true;\r\n        // Unrolled render loop for better per-frame performance\r\n        read.process(state);\r\n        resolveKeyframes.process(state);\r\n        update.process(state);\r\n        preRender.process(state);\r\n        render.process(state);\r\n        postRender.process(state);\r\n        state.isProcessing = false;\r\n        if (runNextFrame && allowKeepAlive) {\r\n            useDefaultElapsed = false;\r\n            scheduleNextBatch(processBatch);\r\n        }\r\n    };\r\n    const wake = () => {\r\n        runNextFrame = true;\r\n        useDefaultElapsed = true;\r\n        if (!state.isProcessing) {\r\n            scheduleNextBatch(processBatch);\r\n        }\r\n    };\r\n    const schedule = stepsOrder.reduce((acc, key) => {\r\n        const step = steps[key];\r\n        acc[key] = (process, keepAlive = false, immediate = false) => {\r\n            if (!runNextFrame)\r\n                wake();\r\n            return step.schedule(process, keepAlive, immediate);\r\n        };\r\n        return acc;\r\n    }, {});\r\n    const cancel = (process) => {\r\n        for (let i = 0; i < stepsOrder.length; i++) {\r\n            steps[stepsOrder[i]].cancel(process);\r\n        }\r\n    };\r\n    return { schedule, cancel, state, steps };\r\n}\r\n\r\nexport { createRenderBatcher };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}